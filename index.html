<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#071130" />
  <meta name="mobile-web-app-capable" content="yes" />

  <!-- PWA / iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="DualPay" />

  <title>DualPay Calculator — BGN ⇄ EUR</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0f172a;
      --bg2:#020617;
      --accent-blue:#0ea5e9;
      --accent-gold:#f59e0b;
      --muted:#94a3b8;
      --rate:1.95583;
    }

    body{
      min-height:100vh;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      color:#e5edf7;
      font-family:Inter,system-ui;
    }

    .font-display{font-family:"Baloo 2",cursive}
    .app{
      backdrop-filter:blur(10px);
      background:rgba(255,255,255,.04);
      border-radius:20px;
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 20px 40px rgba(0,0,0,.6);
    }

    .input{
      background:linear-gradient(180deg,#eef2f7,#e6ebf3);
      color:#020617;
      padding:14px 16px;
      border-radius:12px;
      width:100%;
    }

    .segmented{
      display:inline-flex;
      background:rgba(255,255,255,.08);
      border-radius:999px;
      padding:4px;
      gap:4px;
    }
    .segmented button{
      padding:6px 14px;
      border-radius:999px;
      font-weight:600;
      color:var(--muted);
    }
    .segmented .active{
      background:linear-gradient(90deg,var(--accent-blue),var(--accent-gold));
      color:#020617;
    }

    .pill{
      background:rgba(255,255,255,.06);
      padding:8px 12px;
      border-radius:999px;
    }

    .error{
      background:rgba(255,0,60,.12);
      border:1px solid rgba(255,0,60,.3);
      border-radius:12px;
      padding:12px;
    }
  </style>
</head>

<body class="flex items-center justify-center p-4">

<main class="app max-w-xl w-full p-6">

  <!-- Header -->
  <header class="flex gap-4 items-center mb-6">
    <div id="appIcon" class="w-16 h-16 rounded-xl overflow-hidden"></div>
    <div>
      <h1 class="font-display text-2xl">DualPay Calculator</h1>
      <p class="text-sm text-slate-400">BGN ⇄ EUR Ресто</p>
    </div>
  </header>

  <!-- Inputs -->
  <label class="text-sm font-semibold">Сума за плащане</label>
  <div class="flex gap-2 mt-1">
    <input id="amount" type="number" step="0.01" class="input">
    <select id="amountCurrency" class="input w-28">
      <option value="BGN">BGN</option>
      <option value="EUR">EUR</option>
    </select>
  </div>

  <div class="grid grid-cols-2 gap-3 mt-4">
    <input id="paidBGN" type="number" placeholder="Платено BGN" class="input">
    <input id="paidEUR" type="number" placeholder="Платено EUR" class="input">
  </div>

  <div class="flex justify-between items-center mt-4">
    <span class="text-sm text-slate-400">Покажи рестото в:</span>
    <div class="segmented">
      <button id="showBGN" class="active">BGN</button>
      <button id="showEUR">EUR</button>
    </div>
  </div>

  <div id="messageArea" class="mt-4"></div>

  <footer class="mt-6 pt-4 border-t border-white/10 text-sm text-slate-400 flex justify-between">
    <span>1 EUR = 1.95583 BGN</span>
    <span>9Д • №24</span>
  </footer>
</main>

<script>
const RATE = 1.95583;
const $ = id => document.getElementById(id);

const amount=$("amount"), amountCurrency=$("amountCurrency");
const paidBGN=$("paidBGN"), paidEUR=$("paidEUR");
const message=$("messageArea");
let display="BGN";

function fmt(v,c){return v.toLocaleString("bg-BG",{minimumFractionDigits:2})+(c==="BGN"?" лв":" €");}

function calc(){
  const a=+amount.value||0;
  if(!a){message.innerHTML='<div class="pill">Въведи сума</div>';return;}
  const paid = amountCurrency.value==="BGN"
    ? (+paidBGN.value||0)+(+paidEUR.value||0)*RATE
    : (+paidEUR.value||0)+(+paidBGN.value||0)/RATE;

  if(paid<a){message.innerHTML='<div class="error">Недостатъчна сума</div>';return;}

  let change=paid-a;
  let bgn=amountCurrency.value==="BGN"?change:change*RATE;
  let eur=amountCurrency.value==="EUR"?change:change/RATE;

  message.innerHTML=`
    <div class="pill">
      <div class="text-xl font-display">
        ${display==="BGN"?fmt(bgn,"BGN"):fmt(eur,"EUR")}
      </div>
      <div class="text-sm text-slate-400">
        ${display==="BGN"?fmt(eur,"EUR"):fmt(bgn,"BGN")}
      </div>
    </div>`;
}

["input","change"].forEach(e=>{
  [amount,paidBGN,paidEUR,amountCurrency].forEach(el=>el.addEventListener(e,calc))
});

$("showBGN").onclick=()=>{display="BGN";$("showBGN").classList.add("active");$("showEUR").classList.remove("active");calc();}
$("showEUR").onclick=()=>{display="EUR";$("showEUR").classList.add("active");$("showBGN").classList.remove("active");calc();}

/* ===== ICON + MANIFEST (без service worker registration) ===== */
const iconSVG = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<defs>
<linearGradient id="g" x1="0" x2="1">
<stop offset="0" stop-color="#0ea5e9"/>
<stop offset="1" stop-color="#f59e0b"/>
</linearGradient>
</defs>
<rect width="512" height="512" rx="96" fill="url(#g)"/>
<text x="256" y="300" text-anchor="middle"
 font-size="200" fill="white" font-family="Baloo 2">€лв</text>
</svg>`;
const iconURL="data:image/svg+xml;utf8,"+encodeURIComponent(iconSVG);
$("appIcon").innerHTML=`<img src="${iconURL}" class="w-full h-full">`;

const manifest={
  name:"DualPay Calculator",
  short_name:"DualPay",
  start_url:".",
  display:"standalone",
  background_color:"#071130",
  theme_color:"#071130",
  icons:[{src:iconURL,sizes:"512x512",type:"image/svg+xml"}]
};
const mBlob=new Blob([JSON.stringify(manifest)],{type:"application/json"});
const mURL=URL.createObjectURL(mBlob);
const ml=document.createElement("link");
ml.rel="manifest";ml.href=mURL;document.head.appendChild(ml);
</script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker
      .register('./service-worker.js')
      .then(() => console.log('Service Worker registered'))
      .catch(err => console.error('SW error:', err));
  });
}
</script>

</body>
</html>
